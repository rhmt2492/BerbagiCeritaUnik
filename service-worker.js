const CACHE_NAME="berbagicerita-v3",OFFLINE_URL="/offline.html",CACHEABLE_ASSETS=["/","/index.html","/manifest.json","/styles/styles.css","/scripts/app.js","/assets/logo.png","/assets/placeholder-image.jpg",OFFLINE_URL];self.addEventListener("install",(e=>{console.log("[Service Worker] Installing..."),e.waitUntil((async()=>{try{const e=await caches.open(CACHE_NAME);(await Promise.allSettled(CACHEABLE_ASSETS.map((t=>e.add(t).catch((e=>(console.warn(`[Cache] Gagal: ${t}`,e),null))))))).forEach(((e,t)=>{"fulfilled"===e.status&&e.value&&console.log(`[Cache] Berhasil: ${CACHEABLE_ASSETS[t]}`)})),console.log("[Service Worker] Install completed"),await self.skipWaiting()}catch(e){throw console.error("[Service Worker] Install failed:",e),e}})())})),self.addEventListener("activate",(e=>{console.log("[Service Worker] Activating..."),e.waitUntil((async()=>{try{const e=await caches.keys();await Promise.all(e.map((e=>{if(e!==CACHE_NAME)return console.log(`[Cache] Hapus versi lama: ${e}`),caches.delete(e)}))),console.log("[Service Worker] Klaim kontrol klien"),await self.clients.claim(),console.log("[Service Worker] Ready")}catch(e){throw console.error("[Service Worker] Activation failed:",e),e}})())})),self.addEventListener("fetch",(e=>{"GET"===e.request.method&&e.request.url.startsWith("http")&&("navigate"!==e.request.mode?e.respondWith((async()=>{try{const t=await caches.match(e.request);if(t)return t;const a=await fetch(e.request);return e.request.url.includes("/api/")||"document"===e.request.destination||(await caches.open(CACHE_NAME)).put(e.request,a.clone()),a}catch(t){return"image"===e.request.destination?caches.match("/assets/placeholder-image.jpg"):"style"===e.request.destination||"script"===e.request.destination?new Response("",{headers:{"Content-Type":"text/css"}}):caches.match(OFFLINE_URL)}})()):e.respondWith((async()=>{try{return await fetch(e.request)}catch(e){return await caches.match("/index.html")||caches.match(OFFLINE_URL)}})()))})),self.addEventListener("push",(function(e){let t={title:"Story berhasil dibuat",options:{body:"Tidak ada data dari server.",icon:"/assets/logo.png"}};if(e.data)try{const a=e.data.json();(a.title||a.options)&&(t=a)}catch(e){console.error("Gagal parse push data:",e)}e.waitUntil(self.registration.showNotification(t.title,t.options))})),self.addEventListener("notificationclick",(e=>{console.log("[Service Worker] Notification clicked"),e.notification.close(),e.waitUntil(clients.openWindow(e.notification.data?.url||"/"))}));